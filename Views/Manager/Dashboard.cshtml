@model IEnumerable<TaskManager.Models.TaskItem>

@{
    ViewData["Title"] = "Manager Dashboard";
    var count = 1;
}

<h2 class="text-center text-secondary mb-4">
    <i class="bi bi-speedometer2"></i> Manager Dashboard
</h2>

<div class="row text-center mb-4">

    <div class="col-md-3">
        <div class="card shadow p-3">
            <h6>Total Tasks</h6>
            <h2>@ViewBag.TotalTasks</h2>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow p-3">
            <h6>Completed</h6>
            <h2 class="text-success">@ViewBag.Completed</h2>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow p-3">
            <h6>Pending</h6>
            <h2 class="text-warning">@ViewBag.Pending</h2>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow p-3">
            <h6>Overdue</h6>
            <h2 class="text-danger">@ViewBag.Overdue</h2>
        </div>
    </div>

</div>

<hr />

<h4 class="mt-4 mb-3">
    <i class="bi bi-list-task me-2"></i> All Tasks Overview
</h4>

<table id="taskTable" class="table table-bordered table-hover align-middle table-striped modern-table">
    <thead class="table-dark">
        <tr>
            <th class="text-center">No</th>
            <th class="text-center">Title</th>
            <th class="text-center">Project</th>
            <th class="text-center">Assigned To</th>
            <th class="text-center">Deadline</th>
            <th class="text-center">Status</th>
            <th class="text-center">Progress</th>
        </tr>
    </thead>

    <tbody>
        @foreach (var t in Model)
        {
            var overdue = t.Deadline.HasValue && t.Deadline.Value < DateTime.UtcNow && t.Status != "Completed";

            <tr class="@(overdue ? "table-danger" : "")">
                <td class="text-center">@count</td>

                <td class="text-center">@t.Title</td>

                <td class="text-center">
                    <span class="badge text-primary px-2">
                        @t.Project?.Name
                    </span>
                </td>

                <td class="text-center">
                    <span class="badge text-dark px-2">
                        @t.AssignedTo?.Name
                    </span>
                </td>

                <td class="text-center">
                    @t.Deadline?.ToLocalTime().ToString("dd MMM yyyy")
                </td>

                <td class="text-center">
                    @if (t.Status == "Completed")
                    {
                        <span class="badge bg-success">Completed</span>
                    }
                    else if (t.Status == "In Progress")
                    {
                        <span class="badge bg-warning">In Progress</span>
                    }
                    else
                    {
                        <span class="badge bg-danger">Not Started</span>
                    }
                </td>

                <td class="text-center">
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar 
                            @(t.Progress == 100 ? "bg-success" :
                              t.Progress >= 50 ? "bg-info" :
                              t.Progress >= 20 ? "bg-warning" : "bg-danger")"
                             style="width:@t.Progress%">
                            @t.Progress%
                        </div>
                    </div>
                </td>
            </tr>

            count++;
        }
    </tbody>
</table>

@section Scripts {
<script>
    $(document).ready(function () {
        $('#taskTable').DataTable({
            paging: true,
            pageLength: 10,
            lengthChange: false
        });
    });
</script>
}
